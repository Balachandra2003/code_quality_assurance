name: C++ Code Quality Checks (Relaxed)

on:
  push:
    branches:
      - main
      - feature/**
  pull_request:

jobs:
  lint-and-analyze:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Python and pip
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install cpplint
        run: pip install cpplint

      - name: Install cppcheck
        run: choco install cppcheck --no-progress -y

      - name: Run cpplint on .cpp files
        shell: powershell
        run: |
          Write-Host "üîç Running cpplint..."
          $files = Get-ChildItem -Recurse -Filter *.cpp | ForEach-Object { $_.FullName }
          if ($files.Count -eq 0) {
            Write-Host "‚úÖ No .cpp files found."
          } else {
            cpplint $files
          }

      - name: Run cppcheck on .cpp files (Relaxed)
        shell: powershell
        run: |
          Write-Host "üîç Running cppcheck (relaxed)..."
          $files = Get-ChildItem -Recurse -Filter *.cpp | ForEach-Object { $_.FullName }
          if ($files.Count -eq 0) {
            Write-Host "‚úÖ No .cpp files found."
          } else {
            cppcheck --std=c++11 --enable=all --suppress=missingIncludeSystem --error-exitcode=1 $files
          }
