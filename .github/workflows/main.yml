name: ğŸ§ª C++ Google Test Pipeline

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  run-gtest:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ§ª Run Google Tests on C++ files
        working-directory: cpp
        run: |
          echo "ğŸ§ª Running Google Tests..."
          
          # Find all test files (any .cpp containing 'test' in name)
          test_files=$(find . -maxdepth 1 -name "*test*.cpp")
          
          if [ -z "$test_files" ]; then
            echo "âŒ No C++ test (.cpp) files found in cpp directory."
            exit 1
          else
            echo "ğŸ” Found test files: $test_files"
      
            # Install GTest and dependencies
            sudo apt-get update
            sudo apt-get install -y g++ cmake make libgtest-dev
      
            # Build GTest library
            cd /usr/src/gtest
            sudo cmake .
            sudo make
            sudo cp lib/*.a /usr/lib
            cd $GITHUB_WORKSPACE/cpp
      
            # Compile the test files with Google Test
            mkdir -p build && cd build
            g++ -std=c++17 ../*test*.cpp ../*.cpp -I /usr/include/gtest -pthread -lgtest -lgtest_main -o runTests
      
            # Run the tests
            echo "ğŸ§ª Executing tests..."
            ./runTests
          fi
