name: C++ and Python Code Quality Checks

on:
  push:
    branches:
      - main
      - feature/**
  pull_request:

jobs:
  lint-and-analyze:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install cpplint
        run: pip install cpplint

      - name: Install cppcheck
        run: sudo apt-get update && sudo apt-get install -y cppcheck

      - name: Run cpplint on .cpp files
        run: |
          echo "üîç Running cpplint..."
          files=$(find . -name "*.cpp")
          if [ -z "$files" ]; then
            echo "‚úÖ No .cpp files found."
          else
            cpplint $files
          fi

      - name: Run cppcheck on .cpp files
        run: |
          echo "üîç Running cppcheck..."
          files=$(find . -name "*.cpp")
          if [ -z "$files" ]; then
            echo "‚úÖ No .cpp files found."
          else
            cppcheck --std=c++11 --enable=all --suppress=missingIncludeSystem --error-exitcode=1 $files
          fi

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install pylint and flake8
        run: pip install pylint flake8

      - name: Run pylint on Python files
        run: |
          echo "üîç Running pylint..."
          files=$(find . -name "*.py")
          if [ -z "$files" ]; then
            echo "‚úÖ No Python files found."
          else
            pylint $files
          fi

      - name: Run flake8 on Python files
        run: |
          echo "üîç Running flake8..."
          files=$(find . -name "*.py")
          if [ -z "$files" ]; then
            echo "‚úÖ No Python files found."
          else
            flake8 $files
          fi

      - name: Send failure email to developer
        if: failure()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: ${{ secrets.SMTP_SERVER }}
          server_port: ${{ secrets.SMTP_PORT }}
          subject: GitHub Actions Pipeline Failed for ${{ github.repository }}
          to: ${{ secrets.DEV_EMAIL }}
          from: 'github-actions@yourdomain.com'
          html_body: |
            <h2>üö® Pipeline Failure Notification</h2>
            <p>The GitHub Actions pipeline for repository <b>${{ github.repository }}</b> has failed.</p>
            <p><b>Branch:</b> ${{ github.ref }}</p>
            <p><b>Commit:</b> ${{ github.sha }}</p>
            <p>Please check the details at: <a href="${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}">Pipeline Logs</a></p>
